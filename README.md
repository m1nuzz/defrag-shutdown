# Windows Defragmentation and Optimization Scripts

This repository contains a set of PowerShell scripts and companion batch files to automate the process of defragmenting and optimizing fixed drives on Windows, with an option to shut down the PC upon completion.

It separates the configuration (selecting drives, shutdown option) from the execution (performing the actual optimization) by generating a dedicated execution script.

## How it Works

1.  **`defrag-master.ps1`**: This is the main configuration script. When run, it detects available fixed drives, prompts you to select which drives to optimize, and asks if you want to shut down the PC after optimization.
2.  **`defrag-now.ps1`**: This script is automatically generated by `defrag-master.ps1` based on your selections. It contains the specific list of drives you chose and your shutdown preference. This is the script that performs the actual defragmentation/optimization when executed.
3.  **`defrag-master.cmd`**: A simple batch file to easily launch `defrag-master.ps1` as administrator by double-clicking.
4.  **`defrag-now.cmd`**: A simple batch file to easily launch `defrag-now.ps1` as administrator by double-clicking.

By using this setup, you can run `defrag-master.ps1` (or `defrag-master.cmd`) once to configure your preferences, and then simply run `defrag-now.ps1` (or `defrag-now.cmd`) any time you want to perform the optimization with those saved settings, without needing to make selections every time.

## Prerequisites

* A computer running Windows.
* PowerShell (usually pre-installed on modern Windows versions).
* Administrative privileges are required to run the optimization commands. The provided `.cmd` files attempt to run the scripts with elevated privileges.

## How to Use

1.  **Download or Clone:** Get the script files (`defrag-master.ps1`, `defrag-now.ps1`, `defrag-master.cmd`, `defrag-now.cmd`) onto your Windows machine. It's recommended to keep them in the same folder.
2.  **Configure Optimization Preferences:**
    * Double-click the `defrag-master.cmd` file. This will launch the `defrag-master.ps1` script as administrator.
    * Follow the prompts in the PowerShell window:
        * The script will list your fixed drives and their detected media types (SSD/HDD).
        * Enter the drive letters you want to include in the execution script (e.g., `C D E`) or type `ALL` for all detected valid drives.
        * Enter `Y` if you want the PC to shut down after optimization, or `N` to keep it running.
    * The `defrag-master.ps1` script will then generate the `defrag-now.ps1` script with your chosen settings and automatically attempt to launch it.
3.  **Run Optimization:**
    * Once `defrag-now.ps1` has been generated (or if you want to run the optimization again later with the same settings), double-click the `defrag-now.cmd` file. This will launch the `defrag-now.ps1` script as administrator.
    * The script will perform the optimization for the drives you selected during the configuration step.
    * If you chose the shutdown option, your PC will shut down after the process is complete.

## Optimization Methods Used

The `defrag-now.ps1` script uses the `Optimize-Volume` PowerShell cmdlet, which is the recommended modern approach for disk optimization on Windows.

* **For SSDs:** `Optimize-Volume -DriveLetter [drive letter] -Analyze -ReTrim -Verbose`
* **For HDDs:** `Optimize-Volume -DriveLetter [drive letter] -Analyze -Defrag -Verbose`
* **For Unknown Types:** `Optimize-Volume -DriveLetter [drive letter] -Analyze -Defrag -Verbose`

The `defrag.exe` fallback method has been removed.

## Notes

* Always run the scripts with administrative privileges. The `.cmd` files are configured to request this.
* Ensure your PowerShell Execution Policy allows running local scripts. The `.cmd` files attempt to bypass this specifically for the script file (`-ExecutionPolicy Bypass`).
* Review the code before running any script downloaded from the internet.
